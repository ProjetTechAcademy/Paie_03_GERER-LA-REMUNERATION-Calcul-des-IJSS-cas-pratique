<!DOCTYPE html>
<html lang="fr" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>03_GÃ‰RER LES HS & DIMANCHE / rÃ¨gles 2025 / cas pratique</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body{font-family:'Inter',sans-serif;background:#F8F7F4;color:#3D405B}
    .nav-link{transition:all .3s;border-bottom:2px solid transparent}
    .nav-link:hover,.nav-link.active{color:#81B29A;border-bottom-color:#81B29A}
    .card{background:#fff;border-radius:12px;box-shadow:0 4px 6px rgba(0,0,0,.05);transition:transform .3s, box-shadow .3s}
    .card:hover{transform:translateY(-5px);box-shadow:0 10px 15px rgba(0,0,0,.07)}
    input,select{border-color:#E0E0E0}
    input:focus,select:focus{border-color:#81B29A;box-shadow:0 0 0 2px rgba(129,178,154,.3);outline:none}
    .table-header{background:#F3F4F6}
  </style>
</head>
<body class="antialiased">
  <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-50 shadow-sm">
    <nav class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <div class="flex items-center">
          <span class="font-bold text-lg text-gray-800">03_GÃ‰RER LES HEURES SUP & DIMANCHE</span>
        </div>
        <div class="hidden md:block">
          <div class="ml-10 flex items-baseline space-x-4">
            <a href="#processus" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-700">Processus</a>
            <a href="#regles" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-700">RÃ¨gles 2025</a>
            <a href="#simulateur" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-700">Simulateur</a>
          </div>
        </div>
      </div>
    </nav>
  </header>

  <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12">
    <div class="text-center mb-12">
      <h1 class="text-3xl md:text-4xl font-bold tracking-tight text-gray-900">Heures supplÃ©mentaires & travail du dimanche</h1>
      <p class="mt-4 text-lg text-gray-600 max-w-3xl mx-auto">Un parcours pÃ©dagogique + un calculateur interactif, calÃ©s sur lâ€™actualitÃ© rÃ©glementaire 2025 (France)Â : dÃ©compte hebdo, majorations, exonÃ©rations salariales (11,31Â %), dÃ©duction patronale, non-imposition jusquâ€™Ã  7â€¯500Â â‚¬ et rÃ¨gles Â«Â dimancheÂ Â» par convention.</p>
    </div>

    <!-- 1. Processus -->
    <section id="processus" class="mb-16 scroll-mt-20">
      <div class="card p-6 md:p-8">
        <h2 class="text-3xl font-bold text-gray-800 mb-6">ğŸ” Le Processus de dÃ©compte</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-center">
          <div class="p-4 bg-blue-100 rounded-lg border border-blue-200">
            <p class="font-bold text-blue-800 text-5xl">1</p>
            <h3 class="font-semibold text-blue-800 mt-2">Semaine civile</h3>
            <p class="text-sm text-blue-700 mt-2">Les HS se dÃ©comptent par semaine (lunÂ 0hÂ â†’Â dimÂ 24h, sauf accord). Le constat se fait <strong>Ã  la fin</strong> de la semaine, y compris si elle chevauche 2 mois.</p>
          </div>
          <div class="p-4 bg-yellow-100 rounded-lg border border-yellow-200">
            <p class="font-bold text-yellow-800 text-5xl">2</p>
            <h3 class="font-semibold text-yellow-800 mt-2">Taux de majoration</h3>
            <p class="text-sm text-yellow-700 mt-2">Par dÃ©fautÂ : +25Â % de la 36e Ã  la 43e heure (8Â HS), puis +50Â % au-delÃ . Un accord/CCN peut prÃ©voir dâ€™autres taux.</p>
          </div>
          <div class="p-4 bg-green-100 rounded-lg border border-green-200">
            <p class="font-bold text-green-800 text-5xl">3</p>
            <h3 class="font-semibold text-green-800 mt-2">Dimanche</h3>
            <p class="text-sm text-green-700 mt-2">Pas de prime lÃ©gale systÃ©matiqueÂ : tout dÃ©pend de la CCN / accord / usage. Certaines prÃ©voient +100Â % et repos compensateur.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- 2. RÃ¨gles 2025 -->
    <section id="regles" class="mb-16 scroll-mt-20">
      <div class="card p-6 md:p-8">
        <h2 class="text-3xl font-bold text-gray-800 mb-6">ğŸ“œ RÃ¨gles sociales & fiscales 2025 (synthÃ¨se)</h2>
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
          <div class="p-4 rounded-lg border bg-white">
            <h3 class="font-semibold">ExonÃ©ration salariale (HS/HC)</h3>
            <ul class="list-disc list-inside text-sm text-gray-700 mt-2">
              <li>RÃ©duction de cotisations salariales sur HS/HC dans la limite de <strong>11,31Â %</strong>.</li>
              <li>Applicable sur la rÃ©munÃ©ration + majorations (dans la limite des taux lÃ©gaux ou conventionnels).</li>
            </ul>
          </div>
          <div class="p-4 rounded-lg border bg-white">
            <h3 class="font-semibold">DÃ©duction patronale (HS)</h3>
            <ul class="list-disc list-inside text-sm text-gray-700 mt-2">
              <li><strong>&lt; 20</strong> salariÃ©sÂ : <strong>1,50Â â‚¬</strong> par HS.</li>
              <li><strong>20 Ã  249</strong>Â salariÃ©sÂ : <strong>0,50Â â‚¬</strong> par HS.</li>
            </ul>
          </div>
          <div class="p-4 rounded-lg border bg-white">
            <h3 class="font-semibold">ImpÃ´t sur le revenu</h3>
            <ul class="list-disc list-inside text-sm text-gray-700 mt-2">
              <li>HS exonÃ©rÃ©es dâ€™IR <strong>jusquâ€™Ã  7â€¯500Â â‚¬ nets</strong>/an (dÃ©clarÃ©es quand mÃªme).</li>
            </ul>
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-8">
          <div>
            <h4 class="font-semibold text-lg">Quelles primes compter pour majorer les HSÂ ?</h4>
            <p class="text-sm text-gray-700 mt-2">Inclure les Ã©lÃ©ments liÃ©s Ã  lâ€™exÃ©cution/conditions du travail (exÂ : prime de rendement individuel/collectif contributive, prime de dimanche/jours fÃ©riÃ©s, nuit, insalubritÃ©â€¦). Exclure les Ã©lÃ©ments dÃ©connectÃ©s (13eÂ mois, fin dâ€™annÃ©e, transport/panier remboursements, Ã©vÃ¨nements familiauxâ€¦).</p>
          </div>
          <div>
            <h4 class="font-semibold text-lg">Travail du dimancheÂ : points de vigilance</h4>
            <p class="text-sm text-gray-700 mt-2">DÃ©rogations sectorielles/gÃ©ographiques, volontariat selon cas, repos compensateur Ã©ventuel, non-cumul ou cumul des majorations (HS Ã— Dimanche) selon CCN/jurisprudence.</p>
          </div>
        </div></div></section>

<!-- 2.b DÃ©tail des Ã©lÃ©ments inclus/exclus dans la base HS (pÃ©dagogique) -->
<section id="base-hs-detail" class="mb-16 scroll-mt-20">
  <div class="card p-6 md:p-8">
    <h2 class="text-3xl font-bold text-gray-800 mb-6">ğŸ§© Ce qui <span class="underline">rentre</span> (ou pas) dans la base de calcul des HS</h2>
    <p class="text-sm text-gray-600 mb-4">SynthÃ¨se issue de ta documentation (inclure/exclure par dÃ©faut, hors dispositions conventionnelles plus favorables). Exemples saillantsÂ : <strong>rendent</strong>Â : primes de productivitÃ©/rendement individuel, polyvalence, conditions de travail (nuit, insalubritÃ©, froid, astreinteâ€¦), travail du dimanche/jours fÃ©riÃ©s. <strong>Ne rendent pas</strong>Â : anciennetÃ©, 13e mois/fin dâ€™annÃ©e, Ã©vÃ©nements familiaux, transport/panier/dÃ©placement, primes liÃ©es aux rÃ©sultats globaux/participation/intÃ©ressement, primes CE. îˆ€fileciteîˆ‚turn1file0îˆ</p>
    <div class="overflow-x-auto">
      <table class="min-w-full bg-white border text-sm">
        <thead class="table-header">
          <tr>
            <th class="py-2 px-3 text-left">CatÃ©gorie</th>
            <th class="py-2 px-3 text-left">Exemples</th>
            <th class="py-2 px-3 text-left">Prise en compte base HS</th>
            <th class="py-2 px-3 text-left">Notes</th>
          </tr>
        </thead>
        <tbody>
          <tr class="border-b"><td class="py-2 px-3">ExÃ©cution du travail</td><td class="py-2 px-3">Rendement / productivitÃ© <em>individuelle</em>, polyvalence, commissions</td><td class="py-2 px-3 font-semibold text-green-700">Oui</td><td class="py-2 px-3 text-gray-600">Directement liÃ©es au travail fourni. CommissionsÂ : assimilÃ©es Ã  salaire variable.</td></tr>
          <tr class="border-b"><td class="py-2 px-3">Conditions de travail</td><td class="py-2 px-3">Nuit, astreinte, insalubritÃ©, froid, salissure, danger/risque, situation gÃ©ographique, dimanche, jours fÃ©riÃ©s</td><td class="py-2 px-3 font-semibold text-green-700">Oui</td><td class="py-2 px-3 text-gray-600">Primes inhÃ©rentes Ã  la nature du travail. îˆ€fileciteîˆ‚turn1file3îˆ</td></tr>
          <tr class="border-b"><td class="py-2 px-3">Lieu / frais</td><td class="py-2 px-3">Transport, panier, dÃ©placement, mutation</td><td class="py-2 px-3 font-semibold text-red-700">Non</td><td class="py-2 px-3 text-gray-600">Remboursements de frais (hors Ã©lÃ©ment permanent de salaire). îˆ€fileciteîˆ‚turn1file3îˆ</td></tr>
          <tr class="border-b"><td class="py-2 px-3">Primes gÃ©nÃ©rales</td><td class="py-2 px-3">13e mois, fin dâ€™annÃ©e, vacances, responsabilitÃ©</td><td class="py-2 px-3 font-semibold text-red-700">Non</td><td class="py-2 px-3 text-gray-600">Non liÃ©es Ã  la prestation directe. îˆ€fileciteîˆ‚turn1file0îˆ</td></tr>
          <tr class="border-b"><td class="py-2 px-3">Situation personnelle</td><td class="py-2 px-3">Mariage, naissance, mÃ©daille du travail</td><td class="py-2 px-3 font-semibold text-red-700">Non</td><td class="py-2 px-3 text-gray-600">Ã‰vÃ¨nements personnels. îˆ€fileciteîˆ‚turn1file3îˆ</td></tr>
          <tr class="border-b"><td class="py-2 px-3">Situation de lâ€™entreprise</td><td class="py-2 px-3">Bilan, rÃ©sultat, participation, intÃ©ressement, productivitÃ© <em>collective</em></td><td class="py-2 px-3 font-semibold text-red-700">Non</td><td class="py-2 px-3 text-gray-600">DÃ©pendent de la performance globale. îˆ€fileciteîˆ‚turn1file3îˆ</td></tr>
          <tr><td class="py-2 px-3">AssiduitÃ©</td><td class="py-2 px-3">Prime dâ€™assiduitÃ©</td><td class="py-2 px-3 font-semibold text-amber-700">Cas par cas</td><td class="py-2 px-3 text-gray-600">Jurisprudence vs administrationÂ : paramÃ©trable dans le simulateur. îˆ€fileciteîˆ‚turn1file0îˆ</td></tr>
        </tbody>
      </table>
    </div>
  </div>
</section>

<!-- 3. Simulateur -->
    <section id="simulateur" class="mb-16 scroll-mt-20">
      <div class="card p-6 md:p-8">
        <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">ğŸ–¥ï¸ Simulateur Heures Sup & Dimanche (2025)</h2>

        <!-- 3.1 ParamÃ¨tres entreprise & salariÃ© -->
        <div class="bg-gray-50 p-6 rounded-lg border mb-8">
          <h3 class="text-xl font-semibold mb-4 text-gray-700">1. ParamÃ¨tres</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700">Effectif entreprise</label>
              <select id="effectif" class="mt-1 block w-full rounded-md p-2">
                <option value="-20">&lt; 20</option>
                <option value="20-249">20 Ã  249</option>
                <option value=">=250">â‰¥ 250 (pas de dÃ©duction patronale)</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700">Salaire de base mensuel (â‚¬)</label>
              <input id="salaireBase" type="number" step="0.01" value="2500" class="mt-1 block w-full rounded-md p-2">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700">Heures de base mensuelles</label>
              <input id="heuresBaseMensuelles" type="number" value="151.67" class="mt-1 block w-full rounded-md p-2">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700">(Option rapide) Montant de primes Ã  inclure (â‚¬)</label>
              <input id="primesIncluses" type="number" step="0.01" value="0" class="mt-1 block w-full rounded-md p-2">
            </div>
            <div class="lg:col-span-2">
              <label class="block text-sm font-medium text-gray-700">RÃ¨gle dimanche (CCN)</label>
              <select id="regleDimanche" class="mt-1 block w-full rounded-md p-2">
                <option value="aucune">GÃ©nÃ©rique (pas de prime lÃ©gale)</option>
                <option value="+100">CCN avec majoration 100Â % (exÂ : NÃ©goce Ameublement)</option>
                <option value="syntec100">SYNTECÂ : +100Â % (travail exceptionnel du dimanche) + HS Ã©ventuellement cumulables</option>
                <option value="noncumul90">CCN non-cumul (appliquer la majoration la plus favorable)</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700">Cumul HS Ã— Dimanche</label>
              <select id="cumul" class="mt-1 block w-full rounded-md p-2">
                <option value="non">Non (prendre la majoration la plus favorable)</option>
                <option value="oui">Oui (additionner)</option>
              </select>
            </div>
            <div class="flex items-end">
              <label class="flex items-center text-sm">
                <input id="reposComp" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-indigo-600"> 
                <span class="ml-2">Repos comp. dimanche (si CCN le prÃ©voit)</span>
              </label>
            </div>
          </div>
        </div>

        <!-- 1.b FOULE des Ã©lÃ©ments de rÃ©munÃ©ration (on imagine tout, on choisit ce qui rentre) -->
        <div class="bg-white p-6 rounded-lg border mb-8">
          <h3 class="text-xl font-semibold mb-2 text-gray-700">1.b Ã‰lÃ©ments de rÃ©munÃ©ration â€“ ce qui <em>rentre</em> dans la base HS</h3>
          <p class="text-xs text-gray-600 mb-4">Coche les Ã©lÃ©ments prÃ©sents et saisis leurs montants mensuels. Le simulateur nâ€™additionne dans la base HS que ceux rÃ©putÃ©s <strong>inclus</strong> (ou Â«Â cas par casÂ Â» si tu actives lâ€™option). RÃ©fÃ©rences issues de ta fiche Â«Â RÃ©munÃ©ration pour calcul HSÂ Â». îˆ€fileciteîˆ‚turn1file0îˆ</p>
          <div class="flex items-center gap-3 mb-3">
            <label class="flex items-center text-sm"><input id="inclureAssiduite" type="checkbox" class="mr-2">Inclure la prime dâ€™assiduitÃ© (cas par cas)</label>
          </div>
          <div id="foulePrimes" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
          <div class="mt-4 text-sm">
            <span class="inline-block bg-green-100 text-green-800 px-3 py-1 rounded-full mr-2">Total des Ã©lÃ©ments <strong>INCLUS</strong> pris en base HSÂ : <span id="totalPrimesIncluses" class="font-bold">0,00 â‚¬</span></span>
            <span class="inline-block bg-gray-100 text-gray-800 px-3 py-1 rounded-full">Total des Ã©lÃ©ments <strong>EXCLUS</strong> (hors base HS)Â : <span id="totalPrimesExclues" class="font-bold">0,00 â‚¬</span></span>
          </div>
        </div>
          <h3 class="text-xl font-semibold mb-4 text-gray-700">2. Heures rÃ©alisÃ©es (4 semaines type)</h3>
          <div id="semaines" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
          <p class="text-xs text-gray-500 mt-4">ğŸ’¡ Les HS se dÃ©comptent <strong>par semaine</strong>. Le simulateur applique +25Â % jusquâ€™Ã  8Â HS (36eâ†’43e h) puis +50Â % au-delÃ , sauf si vos rÃ¨gles/CCN diffÃ¨rent.</p>
        </div>

        <!-- 3.3 RÃ©sultats -->
        <div>
          <h3 class="text-xl font-semibold mb-4 text-gray-700">3. RÃ©sultats & bulletin simplifiÃ©</h3>
          <div id="resultats" class="space-y-6"></div>
          <div id="explications" class="space-y-4 mt-6">
            <div class="p-4 rounded-lg border bg-blue-50 border-blue-200">
              <h5 class="font-semibold text-blue-800 mb-2">ğŸ” DÃ©duction forfaitaire patronale â€“ explication & exemple</h5>
              <p class="text-sm text-blue-900">Pour chaque heure supplÃ©mentaire payÃ©e, lâ€™employeur dÃ©duit un forfait de cotisations patronalesÂ : <strong>1,50Â â‚¬</strong> si lâ€™effectif &lt; 20, <strong>0,50Â â‚¬</strong> si 20â€“249, <strong>0</strong> si â‰¥Â 250. Cette dÃ©duction nâ€™impacte pas le brut/net du salariÃ©Â ; elle minore le coÃ»t employeur (souvent visible en paie sous une ligne Â«Â DÃ©duction forfaitaire HSÂ Â» cÃ´tÃ© cotisations patronales).</p>
              <p class="text-sm text-blue-900 mt-2">ExempleÂ : 12Â HS dans le mois et effectif Â«Â 20â€“249Â Â» â‡’ 12Â Ã—Â 0,50Â â‚¬Â =Â <strong>6,00Â â‚¬</strong> de cotisations patronales en moins. Avec Â«Â &lt;Â 20Â Â», ce serait 12Â Ã—Â 1,50Â â‚¬Â =Â <strong>18,00Â â‚¬</strong>.</p>
              <p class="text-xs text-blue-900 mt-1">Le simulateur calcule et affiche cette dÃ©duction dans le bloc Â«Â CÃ´tÃ© employeurÂ Â».</p>
            </div>
            <div class="p-4 rounded-lg border bg-white">
              <h5 class="font-semibold text-gray-800 mb-2">ğŸ§¾ Visualisation sur le bulletin</h5>
              <ul class="list-disc list-inside text-sm text-gray-700">
                <li><strong>Brut</strong>Â : Salaire de base + <em>Heures sup 25Â %</em> + <em>Heures sup 50Â %</em> + Ã©ventuelle <em>Prime dimanche</em> + ajustement nonâ€‘cumul.</li>
                <li><strong>Base HS</strong> utilisÃ©e pour le tauxÂ : <em>taux horaire</em> = (Salaire de base + <span class="underline">Ã©lÃ©ments inclus</span>) / heures mensuelles. Un tableau Â«Â DÃ©tail base HSÂ Â» est affichÃ© ciâ€‘dessous.</li>
                <li><strong>RÃ©duction salariale 11,31Â %</strong>Â : ajoutÃ©e au net (dans la limite des cotisations dues) â€“ affichÃ©e Ã  part.</li>
                <li><strong>DÃ©duction forfaitaire patronale</strong>Â : affichÃ©e cÃ´tÃ© employeur (pas dans le net Ã  payer).</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const inputs = {
      effectif: document.getElementById('effectif'),
      salaireBase: document.getElementById('salaireBase'),
      heuresBaseMensuelles: document.getElementById('heuresBaseMensuelles'),
      primesIncluses: document.getElementById('primesIncluses'),
      regleDimanche: document.getElementById('regleDimanche'),
      cumul: document.getElementById('cumul'),
      reposComp: document.getElementById('reposComp'),
      inclureAssiduite: document.getElementById('inclureAssiduite')
    };

    // ModÃ¨le des Ã©lÃ©ments (foule) â€“ label, clÃ©, inclusParDefaut, note
    const FOULE = [
      {k:'commissions', label:'Commissions (vente/CA)', inclut:true, note:'Composante variable liÃ©e Ã  lâ€™exÃ©cution'},
      {k:'rendement_ind', label:'Prime de rendement / productivitÃ© individuelle', inclut:true, note:'Oui (liÃ©e au travail fourni) îˆ€fileciteîˆ‚turn1file0îˆ'},
      {k:'polyvalence', label:'Prime de polyvalence', inclut:true, note:'Oui îˆ€fileciteîˆ‚turn1file0îˆ'},
      {k:'nuit', label:'Prime de nuit', inclut:true, note:'Oui (conditions de travail) îˆ€fileciteîˆ‚turn1file3îˆ'},
      {k:'astreinte', label:'Astreinte', inclut:true, note:'Oui îˆ€fileciteîˆ‚turn1file3îˆ'},
      {k:'insalubrite', label:'InsalubritÃ© / salissure / froid / risque', inclut:true, note:'Oui (conditions de travail) îˆ€fileciteîˆ‚turn1file3îˆ'},
      {k:'geo', label:'Situation gÃ©ographique (chantier, etc.)', inclut:true, note:'Oui (inhÃ©rent au poste) îˆ€fileciteîˆ‚turn1file3îˆ'},
      {k:'dimanche', label:'Prime travail du dimanche', inclut:true, note:'Oui (conditions de travail) îˆ€fileciteîˆ‚turn1file3îˆ'},
      {k:'jf', label:'Prime jours fÃ©riÃ©s', inclut:true, note:'Oui îˆ€fileciteîˆ‚turn1file3îˆ'},
      {k:'assiduite', label:'Prime dâ€™assiduitÃ©', inclut:false, note:'Cas par cas (option en haut) îˆ€fileciteîˆ‚turn1file0îˆ'},
      {k:'anciennete', label:'Prime dâ€™anciennetÃ©', inclut:false, note:'Non îˆ€fileciteîˆ‚turn1file0îˆ'},
      {k:'13e', label:'13e mois / fin dâ€™annÃ©e / vacances', inclut:false, note:'Non îˆ€fileciteîˆ‚turn1file0îˆ'},
      {k:'responsabilite', label:'Prime de responsabilitÃ© / sÃ©curitÃ©', inclut:false, note:'Non îˆ€fileciteîˆ‚turn1file0îˆ'},
      {k:'transport', label:'Transport / panier / dÃ©placement', inclut:false, note:'Non (frais) îˆ€fileciteîˆ‚turn1file3îˆ'},
      {k:'evenement', label:'Ã‰vÃ©nements familiaux / mÃ©daille', inclut:false, note:'Non îˆ€fileciteîˆ‚turn1file3îˆ'},
      {k:'participation', label:'Participation / intÃ©ressement', inclut:false, note:'Non îˆ€fileciteîˆ‚turn1file3îˆ'},
      {k:'resultat', label:'Primes de rÃ©sultat / bilan / productivitÃ© collective', inclut:false, note:'Non (performance globale) îˆ€fileciteîˆ‚turn1file3îˆ'}
    ];

    // Render "foule" UI
    const fouleDiv = document.getElementById('foulePrimes');
    const champsFoule = {};
    FOULE.forEach(item => {
      const card = document.createElement('div');
      card.className = 'p-3 rounded-lg border bg-white';
      card.innerHTML = `
        <label class="flex items-start gap-2">
          <input type="checkbox" data-k="${item.k}" ${item.inclut?'checked':''} class="mt-1 h-4 w-4 rounded border-gray-300 text-indigo-600">
          <div class="w-full">
            <div class="flex items-center justify-between">
              <span class="text-sm font-medium text-gray-800">${item.label}</span>
              <span class="text-xs ${item.inclut?'text-green-700':'text-red-700'}">${item.inclut?'INCLUS':'EXCLU'}</span>
            </div>
            <p class="text-xs text-gray-500 mt-1">${item.note}</p>
            <div class="mt-2">
              <label class="text-xs text-gray-600">Montant mensuel (â‚¬)</label>
              <input type="number" step="0.01" data-kv="${item.k}" value="0" class="mt-1 block w-full rounded-md p-2 border" />
            </div>
          </div>
        </label>`;
      fouleDiv.appendChild(card);
      champsFoule[item.k] = {
        chk: card.querySelector(`input[type=checkbox][data-k="${item.k}"]`),
        val: card.querySelector(`input[type=number][data-kv="${item.k}"]`),
        meta: item
      };
    });

    // Constantes 2025 vÃ©rifiÃ©es (SMIC utile pour repÃ¨res uniquement)
    const SMIC_HORAIRE_2025 = 11.88; // Insee 2025
    const REDUCTION_SALARIALE_MAX = 0.1131; // plafond 11,31%
    const DEDUC_PATRONALE_LT20 = 1.50; // â‚¬/HS
    const DEDUC_PATRONALE_20_249 = 0.50; // â‚¬/HS

    // Construction des 4 semaines de saisie
    const semainesDiv = document.getElementById('semaines');
    const totalPrimesInclusesSpan = document.getElementById('totalPrimesIncluses');
    const totalPrimesExcluesSpan = document.getElementById('totalPrimesExclues');
    const semaines = [];
    for (let s = 1; s <= 4; s++) {
      const wrap = document.createElement('div');
      wrap.className = 'card p-4';
      wrap.innerHTML = `
        <h4 class="font-semibold text-gray-800 mb-3">Semaine ${s}</h4>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-medium text-gray-700">Heures totales rÃ©alisÃ©es</label>
            <input data-k="heures" type="number" step="0.01" value="35" class="mt-1 block w-full rounded-md p-2">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700">Dont le dimanche</label>
            <input data-k="dimanche" type="number" step="0.01" value="0" class="mt-1 block w-full rounded-md p-2">
          </div>
        </div>`;
      semainesDiv.appendChild(wrap);
      const heures = wrap.querySelector('input[data-k="heures"]');
      const dimanche = wrap.querySelector('input[data-k="dimanche"]');
      semaines.push({ heures, dimanche });
    }

    const resultatsDiv = document.getElementById('resultats');

    // Listeners
    Object.values(inputs).forEach(el => el.addEventListener('input', recalc));
    semaines.forEach(s => {
      s.heures.addEventListener('input', recalc);
      s.dimanche.addEventListener('input', recalc);
    });
    // Listeners foule
    Object.values(champsFoule).forEach(({chk,val})=>{ chk.addEventListener('input', recalc); val.addEventListener('input', recalc); });
    inputs.inclureAssiduite.addEventListener('input', recalc);

    function arr2(n){return Math.round(n*100)/100}

    function recalc(){
      const salaireBase = parseFloat(inputs.salaireBase.value||0);
      const heuresBaseMensuelles = parseFloat(inputs.heuresBaseMensuelles.value||151.67);

      // Calcul prÃ©cis de la base HS Ã  partir de la foule (avec option assiduitÃ©)
      let totalInclus = 0, totalExclus = 0;
      Object.values(champsFoule).forEach(({chk,val,meta})=>{
        const m = parseFloat(val.value||0);
        const estAssiduite = meta.k==='assiduite';
        const doitInclure = meta.inclut || (estAssiduite && inputs.inclureAssiduite.checked);
        if (m>0){ if (doitInclure) totalInclus += m; else totalExclus += m; }
      });
      // Option rapide dâ€™ajout manuel si besoin
      const primesRapides = parseFloat(inputs.primesIncluses.value||0);
      totalInclus += primesRapides;

      const tauxHoraireBase = (salaireBase + totalInclus) / heuresBaseMensuelles;
      totalPrimesInclusesSpan.textContent = `${(Math.round(totalInclus*100)/100).toFixed(2)} â‚¬`;
      totalPrimesExcluesSpan.textContent = `${(Math.round(totalExclus*100)/100).toFixed(2)} â‚¬`;

      const effectifVal = inputs.effectif.value;
      const regleDim = inputs.regleDimanche.value;
      const cumul = inputs.cumul.value === 'oui';

      // DÃ©duction patronale par HS selon effectif
      const deducPatronaleParHS = effectifVal === '-20' ? DEDUC_PATRONALE_LT20 : (effectifVal === '20-249' ? DEDUC_PATRONALE_20_249 : 0);

      // Boucle semaines => calc HS par semaine
      let totalHS25 = 0, totalHS50 = 0, totalDimHeures = 0;
      let remunerationDimanche = 0; // hors HS, prime dimanche/CCN

      semaines.forEach(({heures, dimanche}) => {
        const h = parseFloat(heures.value||0);
        const d = parseFloat(dimanche.value||0);
        const hebdoBase = 35; // supposÃ©; adapter si accord diffÃ©rent
        const hsSemaine = Math.max(0, h - hebdoBase);
        const hs25 = Math.min(8, hsSemaine);
        const hs50 = Math.max(0, hsSemaine - 8);
        totalHS25 += hs25; totalHS50 += hs50; totalDimHeures += d;

        // RÃ¨gle dimanche (hors HS) => si cumul=false on prendra le mieux plus loin
        let primeDimanche = 0;
        if (regleDim === '+100' || regleDim === 'syntec100') {
          primeDimanche = d * tauxHoraireBase; // +100% => doublement => prime = base en plus
        } else if (regleDim === 'aucune' || regleDim === 'noncumul90') {
          primeDimanche = 0; // gÃ©nÃ©rique
        }
        remunerationDimanche += primeDimanche;
      });

      // Heures sup rÃ©munÃ©ration et majorations
      const baseHS = tauxHoraireBase; // inclut les Ã©lÃ©ments rÃ©putÃ©s inclus (foule + option rapide)
      const remunHS25 = totalHS25 * baseHS * 1.25;
      const remunHS50 = totalHS50 * baseHS * 1.50;
      const majHS = (totalHS25 * baseHS * 0.25) + (totalHS50 * baseHS * 0.50);
      const remunHSBrut = remunHS25 + remunHS50; // base+majorations

      // Dimanche vs HS : gestion du cumul
      // Si pas de cumul et CCN prÃ©voit majoration dimanche, on compare pour les heures faites un dimanche ET heures sup
      // Approche simple : appliquer non-cumul en remplaÃ§ant, pour min(totalDimHeures, totalHS), la majoration HS par la majoration dimanche si elle est supÃ©rieure.
      let ajustementNonCumul = 0;
      if (!cumul && (inputs.regleDimanche.value === '+100' || inputs.regleDimanche.value === 'noncumul90')) {
        const totalHS = totalHS25 + totalHS50;
        const chevauchement = Math.min(totalDimHeures, totalHS);
        const majorationDim = baseHS; // +100% => prime = 100% du taux (en plus du salaire de base)
        // Majorations HS moyennes pondÃ©rÃ©es sur chevauchement : approx en prenant 25% sur les 8 premiÃ¨res puis 50%
        const majChev25 = Math.min(chevauchement, totalHS25) * baseHS * 0.25;
        const majChev50 = Math.max(0, chevauchement - totalHS25) * baseHS * 0.50;
        const majHSsurChev = majChev25 + majChev50;
        // Si la majoration dimanche est plus favorable, on remplace la majoration HS par celle de dimanche sur les heures qui se chevauchent
        ajustementNonCumul = Math.max(0, (chevauchement * majorationDim) - majHSsurChev);
      }

      // RÃ©munÃ©ration brute
      const salaireBrutBase = salaireBase;
      const brutHS = remunHSBrut; // comprend base des HS
      const brutDimanche = remunerationDimanche; // prime dim. hors HS (ou ajustÃ©e via non-cumul)
      const brutTotal = salaireBrutBase + brutHS + brutDimanche + ajustementNonCumul;

      // RÃ©duction salariale HS (11,31% max) â€“ nâ€™agit que sur la partie HS/HC (rÃ©munÃ©ration et majoration dans la limite)
      const assietteRedSalHS = remunHSBrut + (cumul ? remunerationDimanche : (remunerationDimanche + ajustementNonCumul));
      const reducSalariale = assietteRedSalHS * REDUCTION_SALARIALE_MAX;

      // DÃ©duction forfaitaire patronale
      const nbHS = totalHS25 + totalHS50;
      const deducPatronale = nbHS * deducPatronaleParHS;

      // Net (approche pÃ©dagogique) : on applique 22% de charges salariales sur le brut, puis on retranche la rÃ©duction salariale calculÃ©e
      const netAvantHS = salaireBrutBase * 0.78; // approx 22%
      const netHS = (brutHS + brutDimanche + ajustementNonCumul) * 0.78;
      const netApresReduc = netAvantHS + netHS + reducSalariale; // la rÃ©duction augmente le net

      // Sortie
      resultatsDiv.innerHTML = '';

      const blocSynthese = `
        <div class="p-4 rounded-lg border bg-gray-100">
          <h4 class="font-bold text-lg text-indigo-700 mb-4">SynthÃ¨se mois (pÃ©dagogique)</h4>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div>
              <table class="min-w-full bg-white border text-sm">
                <tbody>
                  <tr class="border-b"><td class="py-1 px-2">Taux horaire de base (avec Ã©lÃ©ments INCLUS)</td><td class="text-right py-1 px-2">${arr2(baseHS).toFixed(2)} â‚¬</td></tr>
                  <tr class="border-b"><td class="py-1 px-2">HS Ã  25Â %</td><td class="text-right py-1 px-2">${totalHS25} h</td></tr>
                  <tr class="border-b"><td class="py-1 px-2">HS Ã  50Â %</td><td class="text-right py-1 px-2">${totalHS50} h</td></tr>
                  <tr class="border-b"><td class="py-1 px-2">Heures travaillÃ©es le dimanche</td><td class="text-right py-1 px-2">${arr2(totalDimHeures)} h</td></tr>
                </tbody>
              </table>
            </div>
            <div>
              <table class="min-w-full bg-white border text-sm">
                <tbody>
                  <tr class="border-b"><td class="py-1 px-2">RÃ©munÃ©ration HS (base + maj.)</td><td class="text-right py-1 px-2">${arr2(brutHS).toFixed(2)} â‚¬</td></tr>
                  <tr class="border-b"><td class="py-1 px-2">Prime dimanche</td><td class="text-right py-1 px-2">${arr2(brutDimanche).toFixed(2)} â‚¬</td></tr>
                  ${!cumul && (inputs.regleDimanche.value === '+100' || inputs.regleDimanche.value === 'noncumul90') ? `<tr class=\"border-b\"><td class=\"py-1 px-2\">Ajustement non-cumul (plus favorable)</td><td class=\"text-right py-1 px-2\">${arr2(ajustementNonCumul).toFixed(2)} â‚¬</td></tr>`:''}
                  <tr class="border-b font-semibold"><td class="py-1 px-2">Brut total</td><td class="text-right py-1 px-2">${arr2(brutTotal).toFixed(2)} â‚¬</td></tr>
                </tbody>
              </table>
            </div>
            <div>
              <table class="min-w-full bg-white border text-sm">
                <thead class="table-header"><tr><th class="py-2 px-2 text-left">DÃ©tail base HS</th><th class="py-2 px-2 text-right">â‚¬</th></tr></thead>
                <tbody>
                  <tr class="border-b"><td class="py-1 px-2">Salaire de base</td><td class="text-right py-1 px-2">${arr2(salaireBrutBase).toFixed(2)}</td></tr>
                  <tr class="border-b"><td class="py-1 px-2">Ã‰lÃ©ments INCLUS (foule)</td><td class="text-right py-1 px-2">${(Math.round((totalInclus-primesRapides)*100)/100).toFixed(2)}</td></tr>
                  <tr class="border-b"><td class="py-1 px-2">Ajout manuel (option rapide)</td><td class="text-right py-1 px-2">${arr2(primesRapides).toFixed(2)}</td></tr>
                  <tr class="bg-gray-200 font-bold"><td class="py-1 px-2">Total pris en base HS</td><td class="text-right py-1 px-2">${(Math.round((salaireBrutBase+totalInclus)*100)/100).toFixed(2)}</td></tr>
                  <tr class="text-xs"><td class="py-1 px-2 text-gray-500" colspan="2">Ã‰lÃ©ments EXCLUS (frais, 13e mois, participation, etc.)Â : ${arr2(totalExclus).toFixed(2)}Â â‚¬ (hors base HS).</td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>`;

      const blocBulletin = `
        <div class="p-4 rounded-lg border bg-white">
          <h5 class="font-semibold text-gray-800 mb-2">ğŸ§¾ Bulletin simplifiÃ©</h5>
          <table class="min-w-full bg-white border text-sm">
            <tbody>
              <tr class="border-b"><td class="py-1 px-2">Salaire de base</td><td class="text-right py-1 px-2">${arr2(salaireBrutBase).toFixed(2)} â‚¬</td></tr>
              <tr class="border-b"><td class="py-1 px-2">Heures sup 25Â %</td><td class="text-right py-1 px-2">${arr2(totalHS25*baseHS*1.25).toFixed(2)} â‚¬</td></tr>
              <tr class="border-b"><td class="py-1 px-2">Heures sup 50Â %</td><td class="text-right py-1 px-2">${arr2(totalHS50*baseHS*1.50).toFixed(2)} â‚¬</td></tr>
              <tr class="border-b"><td class="py-1 px-2">Prime dimanche</td><td class="text-right py-1 px-2">${arr2(brutDimanche).toFixed(2)} â‚¬</td></tr>
              ${!cumul && (inputs.regleDimanche.value === '+100' || inputs.regleDimanche.value === 'noncumul90') ? `<tr class=\"border-b\"><td class=\"py-1 px-2\">Ajustement non-cumul</td><td class=\"text-right py-1 px-2\">${arr2(ajustementNonCumul).toFixed(2)} â‚¬</td></tr>`:''}
              <tr class="bg-gray-200 font-bold"><td class="py-1 px-2">Brut soumis</td><td class="text-right py-1 px-2">${arr2(brutTotal).toFixed(2)} â‚¬</td></tr>
              <tr><td class="py-1 px-2 text-xs italic text-gray-500" colspan="2">â€¦ Cotisations salariales (â‰ˆ22Â %) â€¦</td></tr>
              <tr class="border-t"><td class="py-1 px-2">RÃ©duction salariale HS (max 11,31Â %)</td><td class="text-right py-1 px-2">+${arr2(reducSalariale).toFixed(2)} â‚¬</td></tr>
              <tr class="border-t font-medium"><td class="py-1 px-2">Net Ã  payer (approx.)</td><td class="text-right py-1 px-2">${arr2(netApresReduc).toFixed(2)} â‚¬</td></tr>
            </tbody>
          </table>
        </div>`;

      const blocCotisations = `
        <div class="p-4 rounded-lg border bg-blue-50 border-blue-200">
          <h5 class="font-semibold text-blue-800 mb-2">ğŸ’¼ CÃ´tÃ© employeur</h5>
          <p class="text-sm text-blue-900">DÃ©duction forfaitaire patronale estimÃ©eÂ : <strong>${nbHS}</strong> HS Ã— ${deducPatronaleParHS.toFixed(2)}Â â‚¬ = <strong>${arr2(deducPatronale).toFixed(2)}Â â‚¬</strong>.</p>
          ${inputs.reposComp.checked ? '<p class="text-xs text-blue-900 mt-1">Repos compensateur dimancheÂ : Ã  organiser selon la CCN/accord (affichage non chiffrÃ©).</p>' : ''}
        </div>`;

      resultatsDiv.innerHTML = blocSynthese + blocBulletin + blocCotisations;
    }

    recalc();
  });
  </script>
</body>
</html>
